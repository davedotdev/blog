<!DOCTYPE html>
<html class="no-js" lang="en-us"><head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="YANG, OpenAPI, Swagger and Code Generation">

<meta name="generator" content="Hugo 0.83.1" />

<title>Welcome to dave.dev</title>

<!-- Mobile Specific Meta -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Favicon -->
<link rel="shortcut icon" type="image/x-icon" href="https://dave.dev/images/favicon.ico" />

<!-- Stylesheets -->
<!-- Themefisher Icon font -->
<link rel="stylesheet" href="https://dave.dev/plugins/themefisher-font/style.css">
<!-- bootstrap.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/bootstrap/dist/css/bootstrap.min.css">
<!-- Lightbox.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/lightbox2/dist/css/lightbox.min.css">
<!-- Slick Carousel -->
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick.css">
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick-theme.css">
<!-- Main Stylesheet -->


<link rel="stylesheet" href="https://dave.dev/css/style.min.css" integrity="" media="screen">

<!-- Essential Scripts -->

<!-- jQuery -->
<script src="https://dave.dev/plugins/jquery/jquery-1.12.4.js"></script>
<!-- Bootstrap -->
<script src="https://dave.dev/plugins/bootstrap/dist/js/popper.min.js"></script>
<script src="https://dave.dev/plugins/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Parallax -->
<script src="https://dave.dev/plugins/parallax/jquery.parallax-1.1.3.js"></script>
<!-- lightbox -->
<script src="https://dave.dev/plugins/lightbox2/dist/js/lightbox.min.js"></script>
<!-- Slick Carousel -->
<script src="https://dave.dev/plugins/slick-carousel/slick/slick.min.js"></script>
<!-- Portfolio Filtering -->
<script src="https://dave.dev/plugins/filterzr/jquery.filterizr.min.js"></script>
<!-- Smooth Scroll js -->
<script src="https://dave.dev/plugins/smooth-scroll/dist/js/smooth-scroll.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCC72vZw-6tGqFyRhhg5CkF2fqfILn2Tsw"></script>
<!-- Main Script -->

<script src="https://dave.dev/js/script.min.js"></script>

<!-- jquery ui -->
<script src="https://dave.dev/plugins/jquery/jquery-ui.js"></script>

<!-- match-height JS -->
<script src="https://dave.dev/plugins/match-height/jquery.matchHeight-min.js"></script>

</head>
<body id="body">
        <!-- Start Preloader -->
<div id="preloader">
    <div class="preloader">
        <div class="sk-circle1 sk-child"></div>
        <div class="sk-circle2 sk-child"></div>
        <div class="sk-circle3 sk-child"></div>
        <div class="sk-circle4 sk-child"></div>
        <div class="sk-circle5 sk-child"></div>
        <div class="sk-circle6 sk-child"></div>
        <div class="sk-circle7 sk-child"></div>
        <div class="sk-circle8 sk-child"></div>
        <div class="sk-circle9 sk-child"></div>
        <div class="sk-circle10 sk-child"></div>
        <div class="sk-circle11 sk-child"></div>
        <div class="sk-circle12 sk-child"></div>
    </div>
</div>
<!-- End Preloader --><!-- Fixed Navigation -->


<section class="header navigation">

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav class="navbar navbar-expand-md">
                    <a class="navbar-brand" href="https://dave.dev/"><h2><font color=#ffffff>dave</font><font color=#ff813f>.</font>dev</h2>
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
                        aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="tf-ion-android-menu"></span>
                    </button>
                    
                    <div id="drapeaux">
                        
                        
                    </div>
                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://dave.dev/"></a>
                            </li>
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/blog">Blog</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/graphops">GraphOps</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/portfolio">Portfolio</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/list">Full List</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/uijourney">My UI Journey</a>
                            </li>
                            
                            
                            <li class="nav-item">
                               <a class="nav-link" href="https://dave.dev/index.xml"><img alt="RSS" src="https://dave.dev/images/rss.png" width="25" height="25"></a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>
<div id="content">



<!-- React & JSX -->
<script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>

<section class="blog-single section">
    <div class="container">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <img src="https://dave.dev/images/blog/placeholder.jpg" class="w-100 mb-3" alt="Post-Image">
                <h2>YANG, OpenAPI, Swagger and Code Generation</h2>
                <div class="post-meta mb-5">
                    <ul class="list-inline">
                        <li class="list-inline-item">
                            <span>By</span>
                            <font color=#ff813f>David Gee</font>
                        </li>
                        <li class="list-inline-item">
                            <span>at</span>
                            <span><font color=#ff813f>October 23, 2018</font></span>
                        </li>
                    </ul>
                </div>
                <p>Sometimes during exploration or projects, I want to take a <a href="https://en.wikipedia.org/wiki/YANG">YANG</a> model and convert it along with related dependencies to a <a href="https://swagger.io/">Swagger</a> format (think <a href="https://www.openapis.org/">OpenAPI</a> if you’re not familiar with this) so I can create a REST or RESTConf API interface. <a href="https://www.opendaylight.org/">OpenDayLight</a> does something very similar for it’s Swagger based North Bound Interface (NBI), more information <a href="https://github.com/bartoszm/yang2swagger">here</a> and just being able to look at the model this way is sometimes helpful. If you’re wondering how helpful this could be, think about developing a client. Using this approach, it’s possible to create stub client and server code for a software implementation, leaving just the logic of what to do when a POST is made or a GET is requested etc.</p>
<p>You may be familiar enough with YANG to know that YANG is a modeling language with its own extensible type system. These YANG models are mostly used for modeling how a programmatic interface to control a feature should be on routers and switches. More recently thanks to the wave of automation sweeping across the globe, YANG models are now used for modeling services, which in turn are rendered over one or more nodes by something else. We’re not going to cover the “else” here, but just the conversion of YANG to Swagger and Swagger to something useful like Go or Python stub bindings!</p>
<p>I’ve done this before but have never documented it, thinking it wasn’t of any value. That said, some tools do not support of the YANG built-in types like “bits” and other tools have issues with <a href="https://www.w3schools.com/xml/xpath_syntax.asp">XPATH</a> expressions. Not being a Java programmer (most of the tools are written in Java), I decided not to create a PR and mend them, but to continue onwards and find a tool that just worked. Nothing (too) against Java, but I just don’t code with nor do I want to.</p>
<p>I’ve found that tools listed in this post have about an 80% success rate and are fine for generic models. When you get in to the more weird, or complex models, these tools are pushed beyond the 80% and present a pandemonium of errors.</p>
<h4 id="the-tale-of-rfc8299">The Tale of RFC8299</h4>
<p><a href="https://tools.ietf.org/html/rfc8299">RFC8299</a> is the “YANG data Model for L3VPN Service Delivery” and is interesting for many reasons. If you’re not familiar with SP networks, that’s fine. This will not dive in to MPLS, BGP-MP, VRFs, RTs, RDs and the like. This particular RFC has several nested YANG dependencies and uses the “bits” YANG native type, which some of the tools do not support. Here is one that is <a href="https://github.com/robshakir/pyangbind/blob/master/docs/yang.md">documented</a>.</p>
<p>If you want to re-produce this for fun, follow along! You’ll require a Browser, a working installation of Docker and Python (2.7 is just fine). You’ll also need to follow the breadcrumbs in each of the YANG files. Whilst this post is to help you figure out how to convert YANG to an OpenAPI variant, I’ve left you the challenge of obtaining the YANG dependencies and placing them in to the correct directory for import by the tools. Directly below is an example import statement. In this case, put the <code>.yang</code> file extension on the name and that’s your YANG file name (the import below would be named ietf-netconf-acm.yang and contains a valid yang model).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">import ietf-netconf-acm {
  prefix nacm;
 }
</code></pre></div><ol>
<li>Create a directory that your YANG and RFC files will live.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir yang_rfcs
$ cd yang_rfcs
$ export YANGDIR<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>echo $PWD<span style="color:#e6db74">`</span>
</code></pre></div><ol start="2">
<li>
<p>Download the text version using the button of RFC8299 from this link: <a href="https://datatracker.ietf.org/doc/rfc8299/">https://datatracker.ietf.org/doc/rfc8299/</a></p>
</li>
<li>
<p>Next, we’re going to use the ‘<a href="https://github.com/xym-tool/xym">xym</a>’ tool to extract the YANG module from the RFC. Modules are published elsewhere on GitHub but I prefer the source, just in case!</p>
</li>
</ol>
<p>Follow the instructions here: <a href="https://github.com/xym-tool/xym">https://github.com/xym-tool/xym</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone https://github.com/xym-tool/xym.git
$ cd xym
$ virtualenv xym
$ source xym/bin/activate
$ pip install requests
$ python setup.py install
$ xym ../rfc8299.txt --dstdir $YANGDIR
$ cd ../
$ ls -la
-rw-r--r--   <span style="color:#ae81ff">1</span> davidgee  staff   <span style="color:#ae81ff">72828</span>  ietf-l3vpn-svc@2018-01-19.yang
-rw-r--r--@  <span style="color:#ae81ff">1</span> davidgee  staff  <span style="color:#ae81ff">344738</span>  rfc8299.txt
drwxr-xr-x  <span style="color:#ae81ff">17</span> davidgee  staff     <span style="color:#ae81ff">544</span>  xym
$ deactivate
$ mv ietf-l3vpn-svc@2018-01-19.yang ietf-l3vpn-svc.yang
</code></pre></div><ol start="4">
<li>Now we have the YANG module extracted from RFC8299, it’s time to convert it from YANG to JSON. For this trick, we’ll use <a href="https://github.com/OpenNetworkingFoundation/EAGLE-Open-Model-Profile-and-Tools.git">EAGLE from the OpenNetworkingFoundation</a>. This project uses Pyang a Python YANG tool for YANG model validation, conversion, transformation and code generation.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone https://github.com/OpenNetworkingFoundation/EAGLE-Open-Model-Profile-and-Tools.git
$ cd EAGLE-Open-Model-Profile-and-Tools/YangJsonTools
$ virtualenv eagle
$ source eagle/bin/activate <span style="color:#75715e"># At this point, the prompt will change to signify the venv activation</span>
$ pip install pyang
$ export PYBINDPLUGIN<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>echo $PWD<span style="color:#e6db74">`</span>
</code></pre></div><p>Up until this point, we’ve activated a Python virtual environment, created an environment variable (PYBINDPLUGIN) and the most important line is next. This is the use of the pyang tool to achieve conversion using the plugins located in the current directory.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pyang --plugindir $PYBINDPLUGIN -f swagger -p $YANGDIR -o export/rfc8299.json $YANGDIR/ietf-l3vpn-svc.yang --generate-rpc<span style="color:#f92672">=</span>False
$ deactivate
$ ls -la export
-rw-r--r--  <span style="color:#ae81ff">1</span> davidgee  staff       <span style="color:#ae81ff">42</span>  README.md
-rw-r--r--  <span style="color:#ae81ff">1</span> davidgee  staff  <span style="color:#ae81ff">1298758</span>  rfc8299.json
</code></pre></div><p>With regards to the last line, the -p switch allows you to tell pyang where the YANG module directory is for dependencies.</p>
<ol start="5">
<li>Now we have our OpenAPI JSON file, we can use the Swagger-UI to visualize it.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cd export
$ export EXPORTS<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>echo $PWD<span style="color:#e6db74">`</span>
$ docker run --name swagger -d -p 80:8080 -e BASE_URL<span style="color:#f92672">=</span>/swagger -e SWAGGER_JSON<span style="color:#f92672">=</span>/swaggerfiles/rfc8299.json -v $EXPORTS:/swaggerfiles swaggerapi/swagger-ui
</code></pre></div><ol start="6">
<li>Sit back, relax and enjoy your hand work by taking a browse of the Swagger browser displaying the API generated from the YANG model and associated Swagger conversion!</li>
</ol>
<p>Open your browser to: http://localhost/swagger/.</p>
<p><img src="/images/blog/swagger_1.png#center" alt="swagger_1"></p>
<ol start="7">
<li>We’re not done yet. Maybe not with this model (because it’s just ruddy huge), but with a simpler one, you might fancy generating some code bindings. Code bindings are automatically generated blobs of code that allows us to create a full implementation of an API. This might be pulling information out of a database, or doing some writes in the background to a device, orchestrator or graph.</li>
</ol>
<p>You have two main choices with Swagger Codegen:</p>
<ol>
<li>Download and use</li>
<li>Do it online with SwaggerHub</li>
</ol>
<p>Let’s download Swagger-Codgen and create some Golang client bindings! Such fun!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cd $YANGDIR
$ cp $PYBINDPLUGIN/export/rfc8299.json ./
<span style="color:#75715e"># Instructions located here https://github.com/swagger-api/swagger-codegen.git</span>
$ wget http://central.maven.org/maven2/io/swagger/swagger-codegen-cli/2.3.1/swagger-codegen-cli-2.3.1.jar -O swagger-codegen-cli.jar
$ mkdir go_output
$ java -jar swagger-codegen-cli.jar help
$ java -jar swagger-codegen-cli.jar generate -i rfc8299.json -l go -o ./go_output
$ ls -la go_output
</code></pre></div><p>f you want to create the server bindings, replace ‘go’ with ‘go-server’.</p>
<p>I’ll leave you to see the surprising amount of Go files, but try it with python instead of go if it isn’t your bag.</p>
<p>Here is some more helpful reading with regards to generating code.
<a href="https://github.com/swagger-api/swagger-codegen/wiki/Server-stub-generator-HOWTO">https://github.com/swagger-api/swagger-codegen/wiki/Server-stub-generator-HOWTO</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir python_output
$ java -jar swagger-codegen-cli.jar generate -i rfc8299.json -l python -o ./python_output
</code></pre></div><p>When it comes to Python servers, replace ‘python’ with ‘python-flask’ for a popular variant of server.</p>
<h4 id="what-failed">What Failed</h4>
<p>For converting the YANG model to Swagger, <a href="https://github.com/corenova/yang-swagger">yang-swagger</a> spat it’s dummy out over lack of support for the native “bits” type. This is not uncommon and will probably change in the future.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yang-swagger -f yaml -o swagger.yaml ietf-l3vpn-svc.yang
<span style="color:#75715e"># Output</span>
WARNING: No configurations found in configuration directory:/Users/davidgee/Documents/yang_rfc/config
WARNING: To disable this warning set SUPPRESS_NO_CONFIG_WARNING in the environment.
unable to parse &amp;apos;./ietf-netconf-acm.yang&amp;apos; YANG module from &amp;apos;/Users/davidgee/Documents/yang_rfc/ietf-netconf-acm.yang&amp;apos;
<span style="color:#f92672">{</span> ExpressionError: <span style="color:#f92672">[</span>module<span style="color:#f92672">(</span>ietf-netconf-acm<span style="color:#f92672">)</span>/typedef<span style="color:#f92672">(</span>access-operations-type<span style="color:#f92672">)</span>/type<span style="color:#f92672">(</span>bits<span style="color:#f92672">)]</span> unable to resolve typedef <span style="color:#66d9ef">for</span> bits
<span style="color:#75715e"># Output truncated to save eyeball space</span>
</code></pre></div><p>For the same conversion step, <a href="https://bitbucket.org/cmurch/yang2swagger-generator.git">swagger-generator-cli</a> Failed mainly due to XPATH issues. I don’t understand Java enough here really to comment, other than as a tool it didn’t work for this particular model and dependencies.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -jar ~/.m2/repository/com/mrv/yangtools/swagger-generator-cli/1.1-SNAPSHOT/swagger-generator-cli-1.1-SNAPSHOT-executable.jar -yang-dir $YANGDIR/yang -output swagger.yaml ietf-l3vpn-svc.yang
<span style="color:#75715e"># Output</span>
2018-10-22 16:44:39,782 <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> WARN  o.o.y.yang.parser.stmt.rfc6020.Utils - Argument <span style="color:#e6db74">&#34;derived-from-or-self(../rp-discovery-type, &amp;apos;l3vpn-svc:bsr-rp&amp;apos;)&#34;</span> is not valid XPath string at <span style="color:#e6db74">&#34;null:800:7&#34;</span>
javax.xml.xpath.XPathExpressionException: javax.xml.transform.TransformerException: Could not find <span style="color:#66d9ef">function</span>: derived-from-or-self
	at com.sun.org.apache.xpath.internal.jaxp.XPathImpl.compile<span style="color:#f92672">(</span>XPathImpl.java:400<span style="color:#f92672">)</span>
<span style="color:#75715e"># Output truncated to save eyeball space. Lots and lots of error output because Java is noisy!</span>
</code></pre></div><h4 id="close">Close</h4>
<p>Thanks for reading and taking part by following along if you did. Hopefully this was useful!</p>
<p>I’ve tried out the steps involved in this post and at the time of writing, they were correct and functional.</p>



                
        <p><i><b>Dave</b></i></p>
    
        <ul class="list-inline">
            <li>
                <span>Tags:</span>
                <span><font color=#ff813f>Integration</font></span>
            </li>
            <li>
                <span>Categories:</span>
                <span><font color=#ff813f>Integration</font></span>
            </li>
        </ul>
            </div>
        </div>
    </div>
</section>


        </div><!-- Footer Start -->
<footer id="footer" class="bg-one">
    <div class="top-footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-3 col-md-3 col-lg-3">
		    <h3>Email Me</h3>
		    <a href="mailto:me@dave.dev">me@dave.dev</a>
		</div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Social Links</h3>
                    <div class="social-icon">
                    <ul class="list-inline social-icon">
                        
                        
                        <li class="list-inline-item">
                            <a href="https://twitter.com/_ipengineer">
                                <i class="tf-ion-social-twitter"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/in/lsp42/">
                                <i class="tf-ion-social-linkedin"></i>
                            </a>
                        </li>
                        
                        
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davidjohngee">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/arsonistgopher">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davedotdev">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://hub.docker.com/u/davedotdev">
                                <i class="tf-ion-code-download"></i>
                            </a>
                        </li>
                        

                    </ul>
                    </div>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Treat the Author</h3>
		        <a href="https://www.buymeacoffee.com/ipengineer"><img border="0" alt="Buy me a coffee!" src="/images/bmac.png"></a>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Copyright</h3>
                    <p><font color=#ff813f>© David Gee and dave.dev, 2021.</font></p>
                </div>

                
                
                
                

            </div>
        </div>
    </div>
</footer>
<!-- end footer -->



</body>
</html>
