<!DOCTYPE html>
<html class="no-js" lang="en-us"><head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="goFAL - File Abstraction in Go">

<meta name="generator" content="Hugo 0.62.0-DEV" />

<title>Welcome to dave.dev</title>

<!-- Mobile Specific Meta -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Favicon -->
<link rel="shortcut icon" type="image/x-icon" href="https://dave.dev/images/favicon.ico" />

<!-- Stylesheets -->
<!-- Themefisher Icon font -->
<link rel="stylesheet" href="https://dave.dev/plugins/themefisher-font/style.css">
<!-- bootstrap.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/bootstrap/dist/css/bootstrap.min.css">
<!-- Lightbox.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/lightbox2/dist/css/lightbox.min.css">
<!-- Slick Carousel -->
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick.css">
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick-theme.css">
<!-- Main Stylesheet -->


<link rel="stylesheet" href="https://dave.dev/css/style.min.css" integrity="" media="screen">

</head>
<body id="body">
        <!-- Start Preloader -->
<div id="preloader">
    <div class="preloader">
        <div class="sk-circle1 sk-child"></div>
        <div class="sk-circle2 sk-child"></div>
        <div class="sk-circle3 sk-child"></div>
        <div class="sk-circle4 sk-child"></div>
        <div class="sk-circle5 sk-child"></div>
        <div class="sk-circle6 sk-child"></div>
        <div class="sk-circle7 sk-child"></div>
        <div class="sk-circle8 sk-child"></div>
        <div class="sk-circle9 sk-child"></div>
        <div class="sk-circle10 sk-child"></div>
        <div class="sk-circle11 sk-child"></div>
        <div class="sk-circle12 sk-child"></div>
    </div>
</div>
<!-- End Preloader --><!-- Fixed Navigation -->


<section class="header navigation">

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav class="navbar navbar-expand-md">
                    <a class="navbar-brand" href="https://dave.dev/">
                        <img src="https://dave.dev/images/logo2.png" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
                        aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="tf-ion-android-menu"></span>
                    </button>
                    
                    <div id="drapeaux">
                        
                        
                    </div>
                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://dave.dev/"></a>
                            </li>
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/blog">Blog</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/portfolio">Portfolio</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/list">Full List</a>
                            </li>
                            
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section><div id="content">

<section class="blog-single section">
    <div class="container">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <img src="https://dave.dev/images/blog/arsonistgopherported.png" class="w-100 mb-3" alt="Post-Image">
                <h2>goFAL - File Abstraction in Go</h2>
                <div class="post-meta mb-5">
                    <ul class="list-inline">
                        <li class="list-inline-item">
                            <span>By</span>
                            David Gee
                        </li>
                        <li class="list-inline-item">
                            <span>at</span>
                            <span>April 24, 2018</span>
                        </li>
                    </ul>
                </div>
                <p>When writing scripts that create or manipulate file and directories, it’s all too easy to get lost using <code>chmod</code> and <code>chdir</code> operating system directives. Move here, do that, change this, write that. Bah. Unless you track very carefully what directory your script is working in, it’s all too easy to get lost. There is always an easier way.</p>
<p>After a quick hunt around using my Google powers and checking out various Go sites, I didn’t find what I was looking for. That might have been due to not looking for the right thing or using the correct keywords, but find it I did not. Therefore, the next logical step was to build what I required, then consume. The result may prove useful.</p>
<p><strong>How do we use it?</strong></p>
<ol>
<li>Build a root node</li>
<li>Add directories or files using the concept of parents</li>
<li>Generate the tree</li>
<li>Manipulate the file contents</li>
<li>Generate hashes</li>
<li>Set permissions</li>
<li>Use</li>
</ol>
<p>Steps 1 through 6 rely on exported package level functions with package level constants for ease of use.</p>
<p><em><strong>What does goFAL stand for?</strong></em> goFAL = <code>Go File Abstraction Layer</code>.</p>
<h4 id="example">Example</h4>
<p>The example makes use of Godeps, so restore the dependencies with ease and build.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd exampleCode
godep restore
go build
./exampleCode
</code></pre></div><p>This assumes a working Go toolchain install. I always work with the latest stable. Simples.</p>
<p>This example involves:</p>
<ol>
<li>Create root directory</li>
<li>Create content directory</li>
<li>Create file in root directory</li>
<li>Create file in content directory</li>
</ol>
<p>Each file and directory has permissions associated with them. Hashes will only be calculated for files.</p>
<p>Source code is <a href="https://github.com/arsonistgopher/gofal.git">here</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#75715e">/*
</span><span style="color:#75715e">Copyright 2018 David Gee
</span><span style="color:#75715e">
</span><span style="color:#75715e">Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span><span style="color:#75715e">you may not use this file except in compliance with the License.
</span><span style="color:#75715e">You may obtain a copy of the License at
</span><span style="color:#75715e">
</span><span style="color:#75715e">    http://www.apache.org/licenses/LICENSE-2.0
</span><span style="color:#75715e">
</span><span style="color:#75715e">Unless required by applicable law or agreed to in writing, software
</span><span style="color:#75715e">distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span><span style="color:#75715e">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span style="color:#75715e">See the License for the specific language governing permissions and
</span><span style="color:#75715e">limitations under the License.
</span><span style="color:#75715e">*/</span>

<span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>

	<span style="color:#e6db74">&#34;github.com/Sirupsen/logrus&#34;</span>
	<span style="color:#a6e22e">gf</span> <span style="color:#e6db74">&#34;github.com/arsonistgopher/gofal&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

	<span style="color:#75715e">/*
</span><span style="color:#75715e">		Example of how to use the goFAL package.
</span><span style="color:#75715e">
</span><span style="color:#75715e">		goFAL builds a tree of file type instances. This tree is then used
</span><span style="color:#75715e">		to build a real file tree when the correct package functions are called.
</span><span style="color:#75715e">		Each file has both SHA1 and SHA256 hashes calculated for easy use.
</span><span style="color:#75715e">
</span><span style="color:#75715e">		This was created to make projects easier to build for packaging and scripting.
</span><span style="color:#75715e">
</span><span style="color:#75715e">		This is an alpha release at best and comes without support.
</span><span style="color:#75715e">
</span><span style="color:#75715e">		Author: David Gee
</span><span style="color:#75715e">		Copyright: David Gee
</span><span style="color:#75715e">		Date: 20th April 2018
</span><span style="color:#75715e">		Contributors welcome!
</span><span style="color:#75715e">	*/</span>

	<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;--- Welcome to the goFAL Demo ---&#34;</span>)

	<span style="color:#75715e">// Create root node called &#39;build&#39;
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">build</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">BuildRoot</span>(<span style="color:#e6db74">&#34;build&#34;</span>, <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">ModePerm</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Add a content directory called &#39;content&#39; and set the permissions
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">content</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">BuildNode</span>(<span style="color:#a6e22e">build</span>, <span style="color:#e6db74">&#34;content&#34;</span>, <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">ModePerm</span>, <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">DIR</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Add a file under the build directory called &#39;content1&#39; and set perms
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">file1</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">BuildNode</span>(<span style="color:#a6e22e">build</span>, <span style="color:#e6db74">&#34;content1.txt&#34;</span>, <span style="color:#ae81ff">0444</span>, <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">FILE</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Add a file under the content directory called &#39;content2&#39; and set perms
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">file2</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">BuildNode</span>(<span style="color:#a6e22e">content</span>, <span style="color:#e6db74">&#34;content2.txt&#34;</span>, <span style="color:#ae81ff">0444</span>, <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">FILE</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Generate file tree on disk
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">Generate</span>(<span style="color:#a6e22e">build</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Insert content
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">file1Content</span> <span style="color:#f92672">:=</span> []byte(<span style="color:#e6db74">&#34;Hello from ArsonistGopher once.&#34;</span>)
	<span style="color:#a6e22e">file2Content</span> <span style="color:#f92672">:=</span> []byte(<span style="color:#e6db74">&#34;Hello from ArsonistGopher twice.&#34;</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">FileWrite</span>(<span style="color:#a6e22e">file1</span>, <span style="color:#a6e22e">file1Content</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">FileWrite</span>(<span style="color:#a6e22e">file2</span>, <span style="color:#a6e22e">file2Content</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Create hashes using the build root as an anchor
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">BuildHashes</span>(<span style="color:#a6e22e">build</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Set permissions (post writing) as per tree data
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">gf</span>.<span style="color:#a6e22e">SetPerms</span>(<span style="color:#a6e22e">build</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// Uncomment line below to print build info
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// fmt.Println(build.String())
</span><span style="color:#75715e"></span>
	<span style="color:#75715e">// Because we have a String() method, we can also call print directly. Uncomment line below.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// fmt.Print(build)
</span><span style="color:#75715e"></span>
	<span style="color:#75715e">// This builds our stringfied object tree
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">build</span>.<span style="color:#a6e22e">TreeString</span>())
}
</code></pre></div><p>Note, it’s possible to print out string representations of the tree nodes in a couple of ways which includes the full tree with hierarchical indentations. Two examples below. TreeString will print the tree from the perspective of the node that <code>TreeString()</code> is being called on.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">fmt.Println(&lt;node&gt;)
fmt.Println(&lt;node&gt;.TreeString())
</code></pre></div><p>Tree output as follows:</p>
<p><strong>Dir/File Perm(Octal)</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">build                   0755
├── content             0777
│   └── content2.txt    0444
└── content1.txt        0444
</code></pre></div><p><strong>ToDo</strong></p>
<ol>
<li>Write some tests</li>
<li>Add signature capabilities for specific branches or the tree</li>
</ol>
<h4 id="the-burn-down">The Burn Down</h4>
<p>This made my life easier!</p>
<h3 id="contributing">Contributing</h3>
<p>Fork and work on master. Create PR and I’ll review.</p>

		Dave
            </div>
        </div>
    </div>
</section>


        </div><!-- Footer Start -->
<footer id="footer" class="bg-one">
    <div class="top-footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-3 col-md-3 col-lg-3">
		    <h3>Email Me</h3>
		    <a href="mailto:me@dave.dev">me@dave.dev</a>
		</div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Social Links</h3>
                    <ul class="list-inline social-icon">
                        
                        
                        <li class="list-inline-item">
                            <a href="https://twitter.com/_ipengineer">
                                <i class="tf-ion-social-twitter"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/in/lsp42/">
                                <i class="tf-ion-social-linkedin"></i>
                            </a>
                        </li>
                        
                        
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davidjohngee">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/arsonistgopher">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davedotdev">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                    </ul>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Treat the Author</h3>
		        <a href="https://www.buymeacoffee.com/ipengineer"><img border="0" alt="Buy me a coffee!" src="/images/bmac.png"></a>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Copyright</h3>
                    <p>© David Gee and dave.dev, 2019.</p>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- end footer -->


<!-- Essential Scripts -->

<!-- jQuery -->
<script src="https://dave.dev/plugins/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="https://dave.dev/plugins/bootstrap/dist/js/popper.min.js"></script>
<script src="https://dave.dev/plugins/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Parallax -->
<script src="https://dave.dev/plugins/parallax/jquery.parallax-1.1.3.js"></script>
<!-- lightbox -->
<script src="https://dave.dev/plugins/lightbox2/dist/js/lightbox.min.js"></script>
<!-- Slick Carousel -->
<script src="https://dave.dev/plugins/slick-carousel/slick/slick.min.js"></script>
<!-- Portfolio Filtering -->
<script src="https://dave.dev/plugins/filterzr/jquery.filterizr.min.js"></script>
<!-- Smooth Scroll js -->
<script src="https://dave.dev/plugins/smooth-scroll/dist/js/smooth-scroll.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCC72vZw-6tGqFyRhhg5CkF2fqfILn2Tsw"></script>
<!-- Main Script -->

<script src="https://dave.dev/js/script.min.js"></script>
</body>
</html>
