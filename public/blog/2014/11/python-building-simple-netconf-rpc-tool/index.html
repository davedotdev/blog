<!DOCTYPE html>
<html class="no-js" lang="en-us"><head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="Python: Building a simple NETCONF RPC Tool">

<meta name="generator" content="Hugo 0.83.1" />

<title>Welcome to dave.dev</title>

<!-- Mobile Specific Meta -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Favicon -->
<link rel="shortcut icon" type="image/x-icon" href="https://dave.dev/images/favicon.ico" />

<!-- Stylesheets -->
<!-- Themefisher Icon font -->
<link rel="stylesheet" href="https://dave.dev/plugins/themefisher-font/style.css">
<!-- bootstrap.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/bootstrap/dist/css/bootstrap.min.css">
<!-- Lightbox.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/lightbox2/dist/css/lightbox.min.css">
<!-- Slick Carousel -->
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick.css">
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick-theme.css">
<!-- Main Stylesheet -->


<link rel="stylesheet" href="https://dave.dev/css/style.min.css" integrity="" media="screen">

<!-- Essential Scripts -->

<!-- jQuery -->
<script src="https://dave.dev/plugins/jquery/jquery-1.12.4.js"></script>
<!-- Bootstrap -->
<script src="https://dave.dev/plugins/bootstrap/dist/js/popper.min.js"></script>
<script src="https://dave.dev/plugins/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Parallax -->
<script src="https://dave.dev/plugins/parallax/jquery.parallax-1.1.3.js"></script>
<!-- lightbox -->
<script src="https://dave.dev/plugins/lightbox2/dist/js/lightbox.min.js"></script>
<!-- Slick Carousel -->
<script src="https://dave.dev/plugins/slick-carousel/slick/slick.min.js"></script>
<!-- Portfolio Filtering -->
<script src="https://dave.dev/plugins/filterzr/jquery.filterizr.min.js"></script>
<!-- Smooth Scroll js -->
<script src="https://dave.dev/plugins/smooth-scroll/dist/js/smooth-scroll.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCC72vZw-6tGqFyRhhg5CkF2fqfILn2Tsw"></script>
<!-- Main Script -->

<script src="https://dave.dev/js/script.min.js"></script>

<!-- jquery ui -->
<script src="https://dave.dev/plugins/jquery/jquery-ui.js"></script>

<!-- match-height JS -->
<script src="https://dave.dev/plugins/match-height/jquery.matchHeight-min.js"></script>

</head>
<body id="body">
        <!-- Start Preloader -->
<div id="preloader">
    <div class="preloader">
        <div class="sk-circle1 sk-child"></div>
        <div class="sk-circle2 sk-child"></div>
        <div class="sk-circle3 sk-child"></div>
        <div class="sk-circle4 sk-child"></div>
        <div class="sk-circle5 sk-child"></div>
        <div class="sk-circle6 sk-child"></div>
        <div class="sk-circle7 sk-child"></div>
        <div class="sk-circle8 sk-child"></div>
        <div class="sk-circle9 sk-child"></div>
        <div class="sk-circle10 sk-child"></div>
        <div class="sk-circle11 sk-child"></div>
        <div class="sk-circle12 sk-child"></div>
    </div>
</div>
<!-- End Preloader --><!-- Fixed Navigation -->


<section class="header navigation">

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav class="navbar navbar-expand-md">
                    <a class="navbar-brand" href="https://dave.dev/"><h2><font color=#ffffff>dave</font><font color=#ff813f>.</font>dev</h2>
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
                        aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="tf-ion-android-menu"></span>
                    </button>
                    
                    <div id="drapeaux">
                        
                        
                    </div>
                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://dave.dev/"></a>
                            </li>
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/blog">Blog</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/graphops">GraphOps</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/portfolio">Portfolio</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/list">Full List</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/uijourney">My UI Journey</a>
                            </li>
                            
                            
                            <li class="nav-item">
                               <a class="nav-link" href="https://dave.dev/index.xml"><img alt="RSS" src="https://dave.dev/images/rss.png" width="25" height="25"></a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>
<div id="content">



<!-- React & JSX -->
<script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>

<section class="blog-single section">
    <div class="container">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <img src="https://dave.dev/images/blog/placeholder.jpg" class="w-100 mb-3" alt="Post-Image">
                <h2>Python: Building a simple NETCONF RPC Tool</h2>
                <div class="post-meta mb-5">
                    <ul class="list-inline">
                        <li class="list-inline-item">
                            <span>By</span>
                            <font color=#ff813f>David Gee</font>
                        </li>
                        <li class="list-inline-item">
                            <span>at</span>
                            <span><font color=#ff813f>November 18, 2014</font></span>
                        </li>
                    </ul>
                </div>
                <p>For a while now I’ve been playing with NETCONF primarily with Cisco Nexus devices. It’s struck me how difficult it is to get good information on doing trivial things like building a simple NETCONF RPC wrapper</p>
<p>How would this be generated for instance? This is wrapper that can be submitted to the ‘xmlagent’ or ‘netconf’ subsystem on a Cisco Nexus device. Note the use of namespaces (nf:rpc, nxos:cmd) where nxos is a namespace? XML is easy for the most part. Namespaces on a personal level meant learning something new and how to deal with that knowledge programmatically.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">&lt;?xml version=&#39;1.0&#39; encoding=&#39;ISO-8859-1&#39;?&gt;
&lt;nf:rpc xmlns:nxos=&#34;http://www.cisco.com/nxos:1.0&#34; xmlns:nf=&#34;urn:ietf:params:xml:ns:netconf:base:1.0&#34; message-id=&#34;42&#34;&gt;
  &lt;nxos:exec-command&gt;
    &lt;nxos:cmd&gt;interface ethernet 2/1; shutdown&lt;/nxos:cmd&gt;
  &lt;/nxos:exec-command&gt;
&lt;/nf:rpc&gt;
]]&gt;]]&gt;
</code></pre></div><p>Other than generating it via a text string and formatting placeholders with “%s”, there has to be a better way! Indeed there is!</p>
<h4 id="netconf-101">NETCONF 101</h4>
<p>The IPEngineer definition: NETCONF is an IETF standardizsed RFC (6241) defined mechanism to configure network devices over some kind of channel using XML encoded data over a secure layer such as SSH. When the channel is opened, a NETCONF ‘Hello’ exchange takes place between the client and server (in this case, my laptop and the Cisco Nexus 7K I’m talking to with NETCONF). During this ‘Hello’, capabilities are also discovered. Once this is complete, we then transmit an RPC wrapper to the NETCONF server, in this case containing an RPC call, which is a NETCONF method of doing something arbitrary like wrapping CLI commands. NETCONF by design operates at content, operations and messages layers. Using the messages layer, we can send and receive data wrapped in RPC (remote procedure call) calls.</p>
<p>The NETCONF protocol is conceptually partitioned into four layers:</p>
<ol>
<li>Content layer: configuration data and notification data.</li>
<li>Operations layer: retrieve and edit the device configuration.</li>
<li>Messages layer: remote procedure calls (RPCs) and notifications.</li>
<li>Secure Transport layer: secure client/server communications.</li>
</ol>
<h4 id="holy-sheep-show-me-the-code-batman">Holy sheep, show me the code Batman!</h4>
<p>The code that follows is loaded on to GitHub <a href="http://github.com/davidjohngee/nxosNCRPC">here</a>. It uses the Python <a href="http://lxml.de/">LXML</a> library to generate the output plus a little string concatenation of (]]&gt;]]&gt;) which serves as the delimeter that in turn tells the NETCONF server that it’s the end of the message.</p>
<p>This is a much more efficient way of creating the NETCONF messages and the nice thing is you can add more subelements programmatically without having to rewrite a string if you were doing this via the “sledgehammer to an egg” approach.</p>
<p>First install the package via pip or easy_install.</p>
<p><code>pip install nxosNCRPC</code></p>
<p>Here’s the test code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> nxosNCRPC <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">---------------------------------------------------------------------------------
</span><span style="color:#e6db74">Let&#39;s try the code out. Create a class, create a command and print the wrapper
</span><span style="color:#e6db74">---------------------------------------------------------------------------------
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    <span style="color:#75715e"># 42 represents the message-id</span>
    call1 <span style="color:#f92672">=</span> nxosNCRPC(<span style="color:#e6db74">&#34;42&#34;</span>)
    call1<span style="color:#f92672">.</span>add_command(<span style="color:#e6db74">&#34;conf t&#34;</span>)
    call1<span style="color:#f92672">.</span>add_command(<span style="color:#e6db74">&#34;int eth2/1&#34;</span>)
    call1<span style="color:#f92672">.</span>add_command(<span style="color:#e6db74">&#34;shut&#34;</span>)
    <span style="color:#75715e"># Some built in helper functions to provide the NETCONF hello, the actual RPC message and the NETCONF close messages</span>
    <span style="color:#66d9ef">print</span> call1<span style="color:#f92672">.</span>hello()
    <span style="color:#66d9ef">print</span> call1<span style="color:#f92672">.</span>message()
    <span style="color:#66d9ef">print</span> call1<span style="color:#f92672">.</span>close()
</code></pre></div><p>And the output?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span>?&gt;
&lt;hello xmlns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;urn:ietf:params:xml:ns:netconf:base:1.0&#34;</span>&gt;
  &lt;capabilities&gt;
    &lt;capability&gt;urn:ietf:params:xml:ns:netconf:base:1.0&lt;/capability&gt;
    &lt;capability&gt;urn:ietf:params:netconf:base:1.0&lt;/capability&gt;
  &lt;/capabilities&gt;
&lt;/hello&gt;
<span style="color:#f92672">]]</span>&gt;<span style="color:#f92672">]]</span>&gt;

&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1.0&#39;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ISO-8859-1&#39;</span>?&gt;
&lt;nc:rpc xmlns:nc<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;urn:ietf:params:xml:ns:netconf:base:1.0&#34;</span> xmlns:nxos<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.cisco.com/nxos:1.0&#34;</span> message-id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;42&#34;</span>&gt;
  &lt;nxos:exec-command&gt;
    &lt;nxos:cmd&gt;conf t&lt;/nxos:cmd&gt;
    &lt;nxos:cmd&gt;int eth2/1&lt;/nxos:cmd&gt;
    &lt;nxos:cmd&gt;shut&lt;/nxos:cmd&gt;
  &lt;/nxos:exec-command&gt;
&lt;/nc:rpc&gt;
<span style="color:#f92672">]]</span>&gt;<span style="color:#f92672">]]</span>&gt;

&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span>?&gt;
&lt;nc:rpc message-id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;101&#34;</span> xmlns:nc<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;urn:ietf:params:xml:ns:netconf:base:1.0&#34;</span> xmlns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.cisco.com/nxos:1.0&#34;</span>&gt;
  &lt;nc:close-session/&gt;
&lt;/nc:rpc&gt;
<span style="color:#f92672">]]</span>&gt;<span style="color:#f92672">]]</span>&gt;
</code></pre></div><p>Have fun!</p>
<h4 id="notes">Notes</h4>
<p>For Windows users using Putty, under SSH options, insert -s:</p>
<p><img src="/images/blog/putty.png#center" alt="putty"></p>



                
        <p><i><b>Dave</b></i></p>
    
        <ul class="list-inline">
            <li>
                <span>Tags:</span>
                <span><font color=#ff813f>Python NETCONF RPC Tooling</font></span>
            </li>
            <li>
                <span>Categories:</span>
                <span><font color=#ff813f>Python NETCONF RPC Tooling</font></span>
            </li>
        </ul>
            </div>
        </div>
    </div>
</section>


        </div><!-- Footer Start -->
<footer id="footer" class="bg-one">
    <div class="top-footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-3 col-md-3 col-lg-3">
		    <h3>Email Me</h3>
		    <a href="mailto:me@dave.dev">me@dave.dev</a>
		</div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Social Links</h3>
                    <div class="social-icon">
                    <ul class="list-inline social-icon">
                        
                        
                        <li class="list-inline-item">
                            <a href="https://twitter.com/_ipengineer">
                                <i class="tf-ion-social-twitter"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/in/lsp42/">
                                <i class="tf-ion-social-linkedin"></i>
                            </a>
                        </li>
                        
                        
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davidjohngee">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/arsonistgopher">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davedotdev">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://hub.docker.com/u/davedotdev">
                                <i class="tf-ion-code-download"></i>
                            </a>
                        </li>
                        

                    </ul>
                    </div>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Treat the Author</h3>
		        <a href="https://www.buymeacoffee.com/ipengineer"><img border="0" alt="Buy me a coffee!" src="/images/bmac.png"></a>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Copyright</h3>
                    <p><font color=#ff813f>© David Gee and dave.dev, 2021.</font></p>
                </div>

                
                
                
                

            </div>
        </div>
    </div>
</footer>
<!-- end footer -->



</body>
</html>
