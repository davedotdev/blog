<!DOCTYPE html>
<html class="no-js" lang="en-us"><head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="StackStorm: Ghost2logger Pack">

<meta name="generator" content="Hugo 0.62.0-DEV" />

<title>Welcome to dave.dev</title>

<!-- Mobile Specific Meta -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Favicon -->
<link rel="shortcut icon" type="image/x-icon" href="https://dave.dev/images/favicon.ico" />

<!-- Stylesheets -->
<!-- Themefisher Icon font -->
<link rel="stylesheet" href="https://dave.dev/plugins/themefisher-font/style.css">
<!-- bootstrap.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/bootstrap/dist/css/bootstrap.min.css">
<!-- Lightbox.min css -->
<link rel="stylesheet" href="https://dave.dev/plugins/lightbox2/dist/css/lightbox.min.css">
<!-- Slick Carousel -->
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick.css">
<link rel="stylesheet" href="https://dave.dev/plugins/slick-carousel/slick/slick-theme.css">
<!-- Main Stylesheet -->


<link rel="stylesheet" href="https://dave.dev/css/style.min.css" integrity="" media="screen">

</head>
<body id="body">
        <!-- Start Preloader -->
<div id="preloader">
    <div class="preloader">
        <div class="sk-circle1 sk-child"></div>
        <div class="sk-circle2 sk-child"></div>
        <div class="sk-circle3 sk-child"></div>
        <div class="sk-circle4 sk-child"></div>
        <div class="sk-circle5 sk-child"></div>
        <div class="sk-circle6 sk-child"></div>
        <div class="sk-circle7 sk-child"></div>
        <div class="sk-circle8 sk-child"></div>
        <div class="sk-circle9 sk-child"></div>
        <div class="sk-circle10 sk-child"></div>
        <div class="sk-circle11 sk-child"></div>
        <div class="sk-circle12 sk-child"></div>
    </div>
</div>
<!-- End Preloader --><!-- Fixed Navigation -->


<section class="header navigation">

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav class="navbar navbar-expand-md">
                    <a class="navbar-brand" href="https://dave.dev/">
                        <img src="https://dave.dev/images/logo2.png" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
                        aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="tf-ion-android-menu"></span>
                    </button>
                    
                    <div id="drapeaux">
                        
                        
                    </div>
                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://dave.dev/"></a>
                            </li>
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/blog">Blog</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/portfolio">Portfolio</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://dave.dev/list">Full List</a>
                            </li>
                            
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section><div id="content">

<section class="blog-single section">
    <div class="container">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <img src="https://dave.dev/images/blog/placeholder.jpg" class="w-100 mb-3" alt="Post-Image">
                <h2>StackStorm: Ghost2logger Pack</h2>
                <div class="post-meta mb-5">
                    <ul class="list-inline">
                        <li class="list-inline-item">
                            <span>By</span>
                            David Gee
                        </li>
                        <li class="list-inline-item">
                            <span>at</span>
                            <span>May 2, 2017</span>
                        </li>
                    </ul>
                </div>
                <p><img src="/images/blog/st2_stackstorm.jpg#center" alt="St2"></p>
<p>Coinciding (roughly) with the version 2.2 release of StackStorm, the Ghost2logger pack has been released.</p>
<p>This pack provides in essence a “Syslog sensor” that provides the user a tuple match on a Syslog entry, tuples in this case being:</p>
<ul>
<li>Syslog Message (Actual syslog message)
MANDATORY AND</li>
<li>Syslog Source (IPv4 address)</li>
</ul>
<p>The actions can then be anything you so desire, either triggering a sinlge action or full blown workflow with Mistral or Cloudslang.</p>
<h4 id="getting-started">Getting Started</h4>
<p>In terms of using the pack, all that is required from the user is the creation of rules and pointing your syslog source to the Ghost2logger location. Most of the time Ghost2logger will live on the same install as StackStorm, so point it at the IP address StackStorm resides. Worried abut StackStorm load? Don’t be. Syslogs aren’t actually processed by StackStorm, but are processed by the Ghost2logger binary. Only matched entries dispatch triggers. There is some inception going on here. Prepare yourself for this: “Rules will only match what the rules have created the match conditions for”. If you understand this hypothesis correctly, you will understand that this is simple feedback from the rules base back to Ghost2logger.</p>
<p>The pack itself consists of a number of simple components:</p>
<ul>
<li>A loopback sensor</li>
<li>A dispatcher sensor</li>
<li>A Golang binary called “Ghost2logger”</li>
<li>A config file that provides attributes to tie these things together</li>
</ul>
<p>The loopback sensor (<a href="https://github.com/StackStorm-Exchange/stackstorm-ghost2logger/blob/master/sensors/ghost2loggerloopback.py">ghost2loggerloopback.py</a>) provides the linkage between StackStorm and the Ghost2logger binary executable. It polls StackStorm for it’s rule database and builds a small in memory database of rules relating to Ghost2logger. The sensor then parses them and sends changes onwards to the Ghost2logger binary.</p>
<p>The dispatcher sensor (<a href="https://github.com/StackStorm-Exchange/stackstorm-ghost2logger/blob/master/sensors/ghost2loggersensor.py">ghost2loggersensor.py</a>) receives “alerts” from the Ghost2logger binary when a match occurs. This sensor “dispatches” the Ghost2logger trigger in to StackStorm.</p>
<p><a href="https://github.com/StackStorm-Exchange/stackstorm-ghost2logger/tree/master/bin">Ghost2logger binary</a> is the crown jewel in this pack. It can be ran in the foreground (original idea was to run it in a screen session) or the preferred route of running it as a <a href="http://ipengineer.net/2017/03/linux-systemd-golang-services-using-kardianos-service/">systemd service</a>.</p>
<p>Configuration relates to all three sensors. The configuration is generated post installation and with the latest release (1.0.1 at the time of writing) if the Ghost2logger service is not running, the Ghost2logger sensors will continue to run. Next step, the Ghost2logger service (ghost2logger.service) will need to be copied to the systemd directory and the service will need starting. Specific instructions are below. Over time I will try and make this easier (perhaps with a Make file).</p>
<p>The first thing you need to do is install the pack. Great news! The pack is now part of the StackStorm Exchange so you can install it straight from StackStorm itself.</p>
<h4 id="install-procedure">Install Procedure</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">st2 pack install ghost2logger
</code></pre></div><p>Then configure the pack.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">st2 pack config ghost2logger
</code></pre></div><p>You can safely accept all the defaults if you are happy with “admin/admin” for the user/password respectively.</p>
<p>You will also need to generate an st2api key and paste in the key in to the config file or in to the config procedure input.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">st2 apikey create -k -m <span style="color:#e6db74">&#39;{&#34;used_by&#34;: &#34;Ghost2logger&#34;}&#39;</span>
</code></pre></div><p>The key that is presented, make a note of (somewhere like Keepass) and paste it into the config file, replacing the st2api key line default entry.</p>
<p>Location of config file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/opt/stackstorm/configs/ghost2logger.yaml
</code></pre></div><p>Replacing the default value of this line “REPLACE_ME” with the key.</p>
<pre><code>  st2_api_key: &quot;REPLACE_ME&quot; &lt;&lt;&lt; Key goes here.
</code></pre><p>Once these steps have been followed, then you can copy the ghost2logger service unit file across to the systemd directory and start the service and validate that it’s running.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo cp /opt/stackstorm/packs/ghost2logger/bin/ghost2logger.service /etc/systemd/system/
systemctl start ghost2logger.service
systemctl is-active ghost2logger.service
systemctl status ghost2logger.service
</code></pre></div><p>At this point we need to restart the sensor container, allowing each sensor to pick up it’s associated configuration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo st2ctl restart-component st2sensorcontainer
</code></pre></div><p>Now that we’ve started things up (the binary and the sensors), let’s check that everything is working! Check the output here to make sure everything is ok and nothing has exited.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Now that we’ve started things up <span style="color:#f92672">(</span>the binary and the sensors<span style="color:#f92672">)</span>, let’s check that everything is working! Check the output here to make sure everything is ok and nothing has exited.
</code></pre></div><p>If you’ve made it this far without any errors, then create a rule using the criteria below and check that the constituent parts appear in the output of journalctl. The rule has an action of nothing, but it’s not important. It’s a test rule.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">name: rule_1
pack: ghost2logger
ref: ghost2logger.rule_1
criteria:
    trigger.host:
        pattern: 192.168.16.1
        type: eq
    trigger.pattern:
        pattern: Logical link.*down$
        type: eq
enabled: true
tags: []
trigger:
    parameters:
    ref: ghost2logger.pattern_match
    type: ghost2logger.pattern_match
type:
    parameters:
    ref: standard
uid: rule:ghost2logger:rule_1
action:
    ref: core.noop
</code></pre></div><p>There is a Python script which can generate the test Syslog located <a href="https://github.com/DavidJohnGee/ghost2logger-tools/blob/master/switchtest.py">here</a>. Inside the script, modify the IP address and run using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python switchtest.py
</code></pre></div><p>At this point, you have a running Ghost2logger install and know how to check logs for anything weird. If you happen to spot something, feel free to raise an issue on the StackStorm repository or email directly.</p>
<p>There is a video here of the final test procedure including what the rule criteria looks like on the GUI. The action is different in the video as it pushes a message to Slack, but that’s fine detail. The core of the demo is the same.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/OlHT8HIEuts" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


		Dave
            </div>
        </div>
    </div>
</section>


        </div><!-- Footer Start -->
<footer id="footer" class="bg-one">
    <div class="top-footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-3 col-md-3 col-lg-3">
		    <h3>Email Me</h3>
		    <a href="mailto:me@dave.dev">me@dave.dev</a>
		</div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Social Links</h3>
                    <ul class="list-inline social-icon">
                        
                        
                        <li class="list-inline-item">
                            <a href="https://twitter.com/_ipengineer">
                                <i class="tf-ion-social-twitter"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/in/lsp42/">
                                <i class="tf-ion-social-linkedin"></i>
                            </a>
                        </li>
                        
                        
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davidjohngee">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/arsonistgopher">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                        
                        <li class="list-inline-item">
                            <a href="https://github.com/davedotdev">
                                <i class="tf-ion-social-github"></i>
                            </a>
                        </li>
                        
                    </ul>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Treat the Author</h3>
		        <a href="https://www.buymeacoffee.com/ipengineer"><img border="0" alt="Buy me a coffee!" src="/images/bmac.png"></a>
                </div>
                <div class="col-sm-3 col-md-3 col-lg-3">
                    <h3>Copyright</h3>
                    <p>© David Gee and dave.dev, 2019.</p>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- end footer -->


<!-- Essential Scripts -->

<!-- jQuery -->
<script src="https://dave.dev/plugins/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="https://dave.dev/plugins/bootstrap/dist/js/popper.min.js"></script>
<script src="https://dave.dev/plugins/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Parallax -->
<script src="https://dave.dev/plugins/parallax/jquery.parallax-1.1.3.js"></script>
<!-- lightbox -->
<script src="https://dave.dev/plugins/lightbox2/dist/js/lightbox.min.js"></script>
<!-- Slick Carousel -->
<script src="https://dave.dev/plugins/slick-carousel/slick/slick.min.js"></script>
<!-- Portfolio Filtering -->
<script src="https://dave.dev/plugins/filterzr/jquery.filterizr.min.js"></script>
<!-- Smooth Scroll js -->
<script src="https://dave.dev/plugins/smooth-scroll/dist/js/smooth-scroll.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCC72vZw-6tGqFyRhhg5CkF2fqfILn2Tsw"></script>
<!-- Main Script -->

<script src="https://dave.dev/js/script.min.js"></script>
</body>
</html>
